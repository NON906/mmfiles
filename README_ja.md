# mmfiles

様々なファイルを検索できる、マルチモーダルな検索システム（RAG）です。  
[ColPali](https://github.com/illuin-tech/colpali)の[vidore/colqwen-omni-v0.1](https://huggingface.co/vidore/colqwen-omni-v0.1)を使用しています。  
Windowsで動作確認しております。  
MCPにも対応おり、対応したLLM（文章生成AI）サービスで検索することも可能です。  
現在のところ、テキスト・画像・音声ファイルに対応しています。  
指定したディレクトリに投入するだけで検索対象にすることができます。

## 起動方法

まず、[uv](https://docs.astral.sh/uv/)を[インストール](https://docs.astral.sh/uv/getting-started/installation/)してください。

インストールしたら、コマンドプロンプトなどで以下のコマンドを実行してください。

```
uvx --from git+https://github.com/NON906/mmfiles mmfiles
```

以下のように``--path``(``-p``)を使用することで、検索対象のディレクトリを変更することができます。  
（デフォルトは、カレントディレクトリの``files``フォルダです）

```
uvx --from git+https://github.com/NON906/mmfiles mmfiles --path "D:\target_dir"
```

起動前に以下の環境変数を設定することで、動作を変更することができます。

| 対応環境変数 | 詳細 |
| --- | --- |
| ``MMFILES_DB_PATH`` | 検索対象ファイルの情報を格納したデータベースファイルのパスを指定します<br>デフォルトは、カレントディレクトリの``.mmfiles.db``ファイルです |
| ``LOAD_IN_4BIT`` | 4ビット量子化の有効/無効を指定できます<br>デフォルトは有効です |
| ``DEVICE_MAP`` | 計算デバイスの指定です<br>``cuda``, ``mps``, ``cpu``のどれかを指定できます<br>度フォルトは``cuda``です |

起動したら、自動でブラウザが開かれ、ファイル説明（Note）の追加（任意）と、ファイル検索を行うことができます。

ファイル検索では、テキストと画像のどちらかを指定できます。  
（テキストが入力されている場合は、画像は無効になります）  
テキストで画像や音声ファイルを検索することも可能です。  
ファイル説明（Note）がある場合は、そちらも検索対象に含まれます。

## MCPの利用方法

起動後のMCPタブの内容を、対応するツールのJSONファイル（``claude_desktop_config.json``など）に追記することで利用することができます。

指定できるオプションと環境変数の一覧は以下の通りです。

| 対応オプション | 詳細 |
| --- | --- |
| ``--path`` (``-p``) | 検索対象のディレクトリのパスを指定します<br>デフォルトは、カレントディレクトリの``files``フォルダです |
| ``--disable_text`` | テキストファイルの検索を除外します |
| ``--disable_image`` | 画像ファイルの検索を除外します |
| ``--disable_audio`` | 音声ファイルの検索を除外します |

| 対応環境変数 | 詳細 |
| --- | --- |
| ``MMFILES_DB_PATH`` | 検索対象ファイルの情報を格納したデータベースファイルのパスを指定します<br>デフォルトは、カレントディレクトリの``.mmfiles.db``ファイルです |
| ``LOAD_IN_4BIT`` | 4ビット量子化の有効/無効を指定できます<br>デフォルトは有効です |
| ``DEVICE_MAP`` | 計算デバイスの指定です<br>``cuda``, ``mps``, ``cpu``のどれかを指定できます<br>度フォルトは``cuda``です |